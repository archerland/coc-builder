$map-width: 800px;

.map {
  min-height: 100%;
  padding: ($header-height + 40px) 40px 120px 40px;
  background-image: url("../images/grass.png");
  background-attachment: fixed;
  @include perspective(3000px);
}

.grid {
  position: relative;
  width: $map-width;
  height: $map-width;
  margin: 0 auto;
  background-color: rgba(#93a944, .3);
  background-size: 40px 40px, 40px 40px, auto;
  background-position: 0 0, 20px 20px;
  @include background-image(
    linear-gradient(45deg,
      rgba(#bfd255, .2) 25%,
      transparent 25%,
      transparent 75%,
      rgba(#bfd255, .2) 75%,
      rgba(#bfd255, .2)
    ),
    linear-gradient(45deg,
      rgba(#bfd255, .2) 25%,
      transparent 25%,
      transparent 75%,
      rgba(#bfd255, .2) 75%,
      rgba(#bfd255, .2)
    )
  );
  @include transition(all .4s);

  .view-mode & {
    @include transform-style(preserve-3d);
    @include transform(translateY(-100px) rotateX(50deg) rotateZ(-45deg));
    box-shadow: -20px 20px 30px rgba(0,0,0,.5);
  }

  .building {
    position: absolute;

    &:before {
      z-index: 2;
    }

    &:after {
      content: '';
      position: absolute;
      z-index: 1;
      top: 1px;
      left: 1px;
      right: 1px;
      bottom: 1px;
      background: url("../images/grass_building.png");
    }

    // Special case for army camps as they're mostly grass
    &.army_camp:before {
      background-size: 60%;
      background-position: 42% 46%;
    }

    // Special case for walls to help with wall effect
    &.wall:before {
      background-size: 80%;
      background-position: center top;
    }

    .view-mode &:before {
      @include transform(rotateZ(45deg));
    }

    &.ok {
      background: rgba(green, .6);
      box-shadow: none;

      &:after {
        display: none;
      }
    }

    &.notok {
      background: rgba(red, .6);
      box-shadow: none;

      &:after {
        display: none;
      }
    }
  }
}
